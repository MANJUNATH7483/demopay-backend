<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - DemoPay</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
        margin: 0; height: 100vh; font-family: 'Segoe UI', sans-serif;
        background: #5f259f; color: white;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    .logo-container { margin-bottom: 40px; text-align: center; }
    .app-logo {
        width: 60px; height: 60px; background: #ffc107; color: #5f259f;
        border-radius: 15px; display: inline-flex; align-items: center; justify-content: center;
        font-weight: 900; font-size: 28px; margin-bottom: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .pin-display { display: flex; gap: 15px; margin-bottom: 50px; }
    .dot {
        width: 12px; height: 12px; border: 1px solid rgba(255,255,255,0.5);
        border-radius: 50%; transition: 0.2s;
    }
    .dot.filled { background: white; border-color: white; transform: scale(1.2); }
    .keypad { 
        width: 100%; position: fixed; bottom: 0; background: white; 
        border-top-left-radius: 20px; border-top-right-radius: 20px;
        color: #333; padding-bottom: 20px;
    }
    .row { display: flex; width: 100%; }
    .key { 
        flex: 1; height: 65px; display: flex; align-items: center; justify-content: center; 
        font-size: 24px; font-weight: 500; cursor: pointer;
    }
    .key:active { background: #f0f0f0; }
    .forgot { font-size: 12px; color: rgba(255,255,255,0.7); margin-top: 20px; cursor: pointer; }
  </style>
</head>
<body>

  <div class="logo-container">
      <div class="app-logo">DP</div>
      <h2 style="margin: 0; font-weight: 500;">DemoPay</h2>
      <p style="opacity: 0.8; font-size: 14px; margin-top: 5px;">Enter your 4-digit PIN</p>
  </div>

  <div class="pin-display">
      <div class="dot" id="d1"></div><div class="dot" id="d2"></div>
      <div class="dot" id="d3"></div><div class="dot" id="d4"></div>
  </div>
  
  <div class="forgot" onclick="alert('Hint: The PIN is 1234')">Forgot PIN?</div>

  <div class="keypad">
      <div class="row"><div class="key" onclick="press(1)">1</div><div class="key" onclick="press(2)">2</div><div class="key" onclick="press(3)">3</div></div>
      <div class="row"><div class="key" onclick="press(4)">4</div><div class="key" onclick="press(5)">5</div><div class="key" onclick="press(6)">6</div></div>
      <div class="row"><div class="key" onclick="press(7)">7</div><div class="key" onclick="press(8)">8</div><div class="key" onclick="press(9)">9</div></div>
      <div class="row"><div class="key"></div><div class="key" onclick="press(0)">0</div><div class="key" onclick="del()"><i class="fa-solid fa-delete-left"></i></div></div>
  </div>
<script>
    let pin = "";
    
    function press(num) {
        if(pin.length < 4) {
            pin += num;
            updateDots();
            if(pin.length === 4) checkPin();
        }
    }
    
    function del() { pin = pin.slice(0, -1); updateDots(); }
    
    function updateDots() {
        for(let i=1; i<=4; i++) {
            document.getElementById('d'+i).className = i <= pin.length ? "dot filled" : "dot";
        }
    }

    async function checkPin() {
        try {
            // CORRECT SYNTAX: Comma is inside the parenthesis
            const response = await fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ pin: pin })
            });

            const data = await response.json();

            if (data.success) {
                location.href = "Home Screen.html";
            } else {
                alert(data.message);
                pin = ""; 
                updateDots();
            }
        } catch (error) {
            console.error(error);
            alert("Server Error! Check python server.py");
            pin = "";
            updateDots();
        }
    }
</script>
</body>
</html>