<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Success</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        body { margin: 0; font-family: sans-serif; background-color: #0F9D58; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        .success-icon { background: white; color: #0F9D58; width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); animation: pop 0.5s; }
        @keyframes pop { 0% { transform: scale(0); } 100% { transform: scale(1); } }
        .amount { font-size: 48px; font-weight: bold; margin: 10px 0; }
        .recipient { background: rgba(255, 255, 255, 0.2); padding: 5px 15px; border-radius: 20px; font-size: 16px; }
        .btn-home { position: absolute; bottom: 50px; background: white; color: #0F9D58; padding: 15px 40px; border-radius: 30px; font-weight: bold; cursor: pointer; text-decoration: none; }
    </style>
</head>
<body>
    <div class="success-icon"><i class="fa-solid fa-check"></i></div>
    <h2 style="margin:0; opacity:0.9;">Payment Successful</h2>
    <div class="amount" id="displayAmount">₹0.00</div>
    <div class="recipient" id="displayName">...</div>

    <a href="Home Screen.html" class="btn-home">Done</a>

    <script>
        // 1. Get Transaction Details from URL
        const urlParams = new URLSearchParams(window.location.search);
        const amount = parseFloat(urlParams.get('amount') || urlParams.get('amt') || "0");
        const name = urlParams.get('name') || "Merchant";
        
        // Display on screen
        document.getElementById('displayAmount').innerText = "₹" + amount;
        document.getElementById('displayName').innerText = "Paid to " + name;
        if(navigator.vibrate) navigator.vibrate(200);

        // --- REAL LOGIC STARTS HERE ---

        // 2. DEDUCT BALANCE
        // Default starting balance is 50,000 if not set
        let currentBalance = parseFloat(localStorage.getItem('walletBalance'));
        if (isNaN(currentBalance)) currentBalance = 50000; 

        // Only deduct if we haven't processed this specific page load yet (simple check)
        // ideally we use IDs, but for a demo, this is fine:
        currentBalance = currentBalance - amount;
        localStorage.setItem('walletBalance', currentBalance);

        // 3. SAVE TO HISTORY
        // Get existing history or empty list
        let history = JSON.parse(localStorage.getItem('txHistory')) || [];
        
        // Add new transaction to the TOP of the list
        const newTx = {
            name: name,
            amount: amount,
            date: new Date().toLocaleDateString('en-IN', { day: 'numeric', month: 'short', hour: '2-digit', minute:'2-digit'}),
            type: 'Debit'
        };
        history.unshift(newTx);
        
        // Save back to storage
        localStorage.setItem('txHistory', JSON.stringify(history));

    </script>
</body>
</html>
